<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox + Threebox Example</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .map-overlay {
            font:
                12px/20px 'Helvetica Neue',
                Arial,
                Helvetica,
                sans-serif;
            position: absolute;
            width: 200px;
            top: 0;
            left: 0;
            padding: 10px;
        }

        .map-overlay .map-overlay-inner {
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .map-overlay-inner fieldset {
            display: flex;
            justify-content: space-between;
            border: none;
        }

        .map-overlay-inner label {
            font-weight: bold;
            margin-right: 10px;
        }

        .map-overlay-inner .select-fieldset {
            display: block;
        }

        .map-overlay-inner .select-fieldset label {
            display: block;
            margin-bottom: 5px;
        }

        .map-overlay-inner .select-fieldset select {
            width: 100%;
        }

        .lat-lng {
            width: 100px;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/gh/jscastro76/threebox@v.2.2.2/dist/threebox.min.js"
        type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/gh/jscastro76/threebox@v.2.2.2/dist/threebox.css" rel="stylesheet">

    <div id="map" style="position: absolute; top: 0; bottom: 0; width: 100%;"></div>
    <div class="map-overlay top w-[20vw]">
        <div class="map-overlay-inner">
            <fieldset>
                <label>Day/Night Mode</label>
                <select id="dayNightMode">
                    <option value="day">Day</option>
                    <option value="night">Night</option>
                </select>
            </fieldset>
            <fieldset>
                <label>Show Road</label>
                <input type="checkbox" id="showRoad" checked />
            </fieldset>
            <fieldset>
                <label>Longitude</label>
                <input type="number" id="lng" value="35.21633" step="any" class="lat-lng"/>
            </fieldset>
            <fieldset>
                <label>Latitude</label>
                <input type="number" id="lat" value="31.76904" step="any" class="lat-lng"/>
            </fieldset>
        </div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
    <script>
        mapboxgl.accessToken = "pk.eyJ1IjoiYWRzLWVvIiwiYSI6ImNseDlhajRmbDI2N2gyaXFzaTV3ZnhuMnAifQ.f3UUqrMSf5guXYFR62TWdg";

        const jesusTravelLocations = [
            { name: "Bethlehem", coordinates: [35.2024, 31.7054] },
            { name: "Nazareth", coordinates: [35.3035, 32.6996] },
            { name: "Jerusalem", coordinates: [35.2137, 31.7683] },
            { name: "Sea of Galilee", coordinates: [35.5872, 32.8334] },
            { name: "Capernaum", coordinates: [35.5733, 32.8804] },
            { name: "Bethsaida", coordinates: [35.5611, 32.9123] },
            { name: "Mount of Beatitudes", coordinates: [35.5550, 32.8800] },
            { name: "Caesarea Philippi", coordinates: [35.6998, 33.2489] },
            { name: "Tyre", coordinates: [35.1927, 33.2706] }, // Liban
            { name: "Sidon", coordinates: [35.3750, 33.5587] }, // Liban
            { name: "Cana", coordinates: [35.3419, 32.7452] },
            { name: "Nain", coordinates: [35.3273, 32.6782] },
            { name: "Jericho", coordinates: [35.4582, 31.8562] },
            { name: "Bethany", coordinates: [35.2620, 31.7717] },
            { name: "Samaria", coordinates: [35.2304, 32.2206] },
            { name: "Sychar", coordinates: [35.2720, 32.2133] },
            { name: "Magdala", coordinates: [35.5080, 32.8369] },
            // Ajoutez d'autres localisations ici
        ];

        let map = null;
        let showBuilding = true;
        let showRoad = true;
        let mountainHeight = 100;

        function initializeMap() {
            map = new mapboxgl.Map({
                container: 'map',
                style: "mapbox://styles/ads-eo/clxy9r3e5000p01nw44s08gaw",
                center: [35.21633, 31.76904],
                zoom: 9,
                pitch: 62,
                bearing: -20,
            });

            map.on('move', () => {
                document.getElementById('lng').value = map.getCenter().lng.toFixed(4);
                document.getElementById('lat').value = map.getCenter().lat.toFixed(4);
            });

            map.on('load', () => {
                updateMapStyle();
                addLocations();
            });

            // eslint-disable-next-line no-undef
            const tb = (window.tb = new Threebox(
                map,
                map.getCanvas().getContext('webgl'),
                {
                    defaultLights: true
                }
            ));

            map.on('style.load', () => {
                add3DWidget();
            });

            // document.getElementById('season').addEventListener('change', () => {
            //     updateMapStyle();
            //     addLocations();
            // });

            document.getElementById('dayNightMode').addEventListener('change', () => {
                updateMapStyle();
                addLocations();
            });

            document.getElementById('showRoad').addEventListener('change', () => {
                showRoad = document.getElementById('showRoad').checked;
                handleCheckboxChange('road-primary-navigation', 'visibility', showRoad ? 'visible' : 'none');
                handleCheckboxChange('road-secondary-tertiary-navigation', 'visibility', showRoad ? 'visible' : 'none');
                handleCheckboxChange('road-street-navigation', 'visibility', showRoad ? 'visible' : 'none');
                handleCheckboxChange('road-minor-navigation', 'visibility', showRoad ? 'visible' : 'none');
            });
        }

        function add3DWidget() {
            map.addLayer({
                id: 'custom-threebox-model',
                type: 'custom',
                renderingMode: '3d',
                onAdd: function () {
                    // Creative Commons License attribution:  Metlife Building model by https://sketchfab.com/NanoRay
                    // https://sketchfab.com/3d-models/metlife-building-32d3a4a1810a4d64abb9547bb661f7f3
                    const scale = 3.2;
                    const options = {
                        obj: '/assets/JERUSALEM.gltf',
                        type: 'gltf',
                        scale: { x: scale, y: scale, z:3 },
                        units: 'meters',
                        rotation: { x: 90, y: -90, z: 0 }
                    };

                    tb.loadObj(options, (model) => {
                        model.setCoords([35.2137, 31.7683]);
                        model.setRotation({ x: 0, y: 0, z: 241 });
                        tb.add(model);
                    });
                },

                render: function () {
                    tb.update();
                }
            });
        }

        function updateMapStyle() {
            const dayNightMode = document.getElementById('dayNightMode').value;
            if (dayNightMode === 'night') {
                map.setStyle("mapbox://styles/ads-eo/clxyac48g000g01pic1548rol");
            } else {
                map.setStyle("mapbox://styles/ads-eo/clxy9r3e5000p01nw44s08gaw");
            }
        }

        function addLocations() {
            jesusTravelLocations.forEach(location => {
                const marker = new mapboxgl.Marker()
                    .setLngLat(location.coordinates)
                    .setPopup(new mapboxgl.Popup().setText(location.name))
                    .addTo(map);

                marker.getElement().addEventListener('click', () => {
                    map.flyTo({
                        center: location.coordinates,
                        zoom: 16
                    });
                });
            });
        }

        function handleCheckboxChange(layerId, property, value) {
            map.setLayoutProperty(layerId, property, value);
        }

        initializeMap();

    </script>

</body>

</html>